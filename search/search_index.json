{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introduction","text":""},{"location":"#totpvault","title":"TOTPVault","text":"<p>TOTPVault is a secure hardware vault for storing TOTP codes for two-factor authentication. It is compatible with websites and applications which support authenticators such as Google Authenticator or Authy.</p> <p>For a detailed look at the hardware components, see the Hardware Overview.</p> <p></p>"},{"location":"#websites-tested","title":"Websites Tested","text":"<p>TOTPVault should work on almost all TOTP-based authentication sites. The list below just shows which ones have been validated to be working</p> Website Supported Google Y Digital Ocean Amazon Microsoft Instagram Paypal eBay Cloudflare Dropbox Github Gitlab Linkedin Protonmail"},{"location":"#faq","title":"FAQ","text":""},{"location":"#why-choose-esp32-c3-for-the-microcontroller","title":"Why choose ESP32-C3 for the microcontroller?","text":"<p>The ESP32 chips have strong hardware security features such as HWRNG, encryption/hashing support, secure boot, and encrypted flash.</p> <p>Other chips have some or all of these features, however the ESP32-C3 is PSA-L1 certified, has good support for Rust firmware, and is affordable.</p>"},{"location":"#the-esp32-has-wifibluetooth-does-this-device-use-either","title":"The ESP32 has Wifi/Bluetooth, does this device use either?","text":"<p>No, there is no antenna on the board and the Wifi/Bluetooth stack is disabled in the firmware.</p>"},{"location":"#if-somebody-steals-my-device-can-they-generate-totp-codes-for-my-accounts","title":"If somebody steals my device, can they generate TOTP codes for my accounts?","text":"<p>No, as long as your password is strong they cannot unlock the vault and generate codes.</p>"},{"location":"#troubleshooting","title":"Troubleshooting","text":""},{"location":"#device-does-not-show-up","title":"Device does not show up","text":"<p>Try reinserting the device and look for a USB device with the VID 0x1A86 and PID 0x55D3. </p> <p>You can run <code>dev-info -v</code> which will print verbose output as to how the device is selected. It is possible another device exists with the same VID/PID in which case use <code>-p</code> to specify the path to the exact device</p>"},{"location":"#unexpected-end-of-file-error","title":"\"unexpected end of file\" Error","text":"<pre><code>Unable to get device status from: /dev/tty.usbmodem59090561791\n    Error = IO error while reading data: unexpected end of file\n</code></pre> <p>The vault is taking a while to perform operations, increase the timeout in the user application with <code>--timeout</code></p>"},{"location":"commands/","title":"TOTPVault CLI Commands","text":""},{"location":"commands/#sync-time","title":"Sync Time","text":"<p>Synchronize the system time with the device.</p> <p>Usage:</p> <pre><code>totpvault-cli sync-time\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli sync-time\nSuccessfully synced time to: 1704892800\n</code></pre>"},{"location":"commands/#list-credentials","title":"List Credentials","text":"<p>List all stored credentials on the device.</p> <p>Usage:</p> <pre><code>totpvault-cli list-credentials\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli list-credentials\n[Slot 0]: example.com\n[Slot 1]: another-site.org\n</code></pre>"},{"location":"commands/#delete-credential","title":"Delete Credential","text":"<p>Delete a credential for a specific domain.</p> <p>Usage:</p> <pre><code>totpvault-cli delete-credential --domain &lt;domain_name&gt;\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli delete-credential --domain example.com\nSuccessfully deleted credential\n</code></pre>"},{"location":"commands/#add-credential","title":"Add Credential","text":"<p>Add a new TOTP credential.</p> <p>Usage:</p> <pre><code>totpvault-cli add-credential --domain &lt;domain_name&gt;\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli add-credential --domain new-service.net\nEnter TOTP Secret Key: JBSWY3DPEHPK3PXP\nSuccessfully added credential\n</code></pre>"},{"location":"commands/#totp-code","title":"Totp Code","text":"<p>Get TOTP credential for a domain.</p> <p>Usage:</p> <pre><code>totpvault-cli totp-code --domain &lt;domain_name&gt;\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli totp-code --domain example.com\n123456\n25s remaining\n</code></pre>"},{"location":"commands/#init-vault","title":"Init Vault","text":"<p>Initialize/Reset the vault (danger).</p> <p>Usage:</p> <pre><code>totpvault-cli init-vault\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli init-vault\n**************** WARNING ****************\nInitializing the vault will WIPE EXISTING CREDENTIALS!\nPlease make sure you will not be locked out of your accounts!\n\nDo you want to continue? (yes/no): yes\nEnter vault password:\nEnter vault password (confirm):\nSuccessfully initialized vault!\n</code></pre>"},{"location":"commands/#device-info","title":"Device Info","text":"<p>Get device information.</p> <p>Free/Used slots is always <code>0</code> when the vault is locked for security reasons</p> <p>Usage:</p> <pre><code>totpvault-cli dev-info\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli dev-info\nDevice Status:\n    Vault: Unlocked\n    Total Slots: 10\n    Used Slots: 2\n    Free Slots: 8\n    Current Timestamp: 1704892800 delta=0 (In-sync)\n    Version: 1.0.0\n    ED25519 Public Key: IiG0924qxqsDTs7TF8ZAexXJh2ZsRA5hcd9juC0tBGM=\n    Key Fingerprint (SHA256): D9:42:BB:FB:7C:D8:B8:47:3D:AF:72:34:98:2B:44:61:4E:BD:8A:AD:32:97:52:C0:14:9C:96:63:5C:22:39:42\n</code></pre>"},{"location":"commands/#attest-device","title":"Attest Device","text":"<p>Perform device attestation.</p> <p><code>&lt;public_key&gt;</code> should be the public key (not fingerprint) of the trusted device to send a challenge to.</p> <p>Usage:</p> <pre><code>totpvault-cli attest-dev --key &lt;public_key&gt;\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli attest-dev -k IiG0924qxqsDTs7TF8ZAexXJh2ZsRA5hcd9juC0tBGM=`\nPublic key: IiG0924qxqsDTs7TF8ZAexXJh2ZsRA5hcd9juC0tBGM=\nFingerprint (SHA256): D9:42:BB:FB:7C:D8:B8:47:3D:AF:72:34:98:2B:44:61:4E:BD:8A:AD:32:97:52:C0:14:9C:96:63:5C:22:39:42\nSuccessfully attested device\n</code></pre>"},{"location":"commands/#list-devices","title":"List Devices","text":"<p>List connected devices.</p> <p>Use <code>-v</code> to view detailed information</p> <p>Usage:</p> <pre><code>totpvault-cli list-devices\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli list-devices\nFound TOTPVault device: /dev/ttyACM0\n</code></pre>"},{"location":"commands/#unlock-vault","title":"Unlock Vault","text":"<p>Unlock the vault</p> <p>Usage:</p> <pre><code>totpvault-cli unlock-vault\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli unlock-vault\nEnter password:\nSuccessfully unlocked vault\n</code></pre>"},{"location":"commands/#lock-vault","title":"Lock Vault","text":"<p>Lock the vault</p> <p>Usage:</p> <pre><code>totpvault-cli lock-vault\n</code></pre> <p>Example:</p> <pre><code>totpvault-cli lock-vault\nLocked vault\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#installation","title":"Installation","text":"<p>First, clone the repository and build the <code>totpvault-cli</code> tool:</p> <pre><code>git clone https://github.com/gfoudree/totpvault\ncd totpvault/totpvault-cli\ncargo build -r\n</code></pre> <p>The executable will be located at <code>target/release/totpvault-cli</code>. You can optionally move it to a directory in your <code>PATH</code> for easier access.</p>"},{"location":"getting-started/#find-the-totpvault-device","title":"Find the TOTPVault device","text":"<p>Insert the device into your computer and search for it</p> <pre><code>$ totpvault-cli dev-info\n\nDevice Status:\n    Vault: Locked\n    Total Slots: 64\n    Used Slots: 0\n    Free Slots: 0\n    Current Timestamp: 89 (Out-of-Sync)\n    Version: TOTPVault Version 0.1\n    Public Key: 2ppFZmElF9eAIi2QaJtwG9y2g3oJAPU/izSje4AbTFQ=\n    Key Fingerprint: 4C:FD:D5:D2:9B:70:59:8A:...\n</code></pre> <p>If you don't see the device, try running with <code>-v</code> to see the verbose output. You can manually specify a device with <code>-p</code></p>"},{"location":"getting-started/#initialize-the-vault","title":"Initialize the vault","text":"<p>Initialize the vault with a strong password. This wipes all existing credentials in the vault, beware!</p> <pre><code>$ totpvault-cli init-vault\n\n**************** WARNING ****************\nInitializing the vault will WIPE EXISTING CREDENTIALS!\nPlease make sure you will not be locked out of your accounts!\n\nDo you want to continue? (yes/no):\nyes\nEnter vault password:\nEnter vault password (confirm):\nSuccessfully initialized vault!\n</code></pre>"},{"location":"getting-started/#unlock-the-vault","title":"Unlock the vault","text":"<pre><code>$ totpvault-cli unlock-vault\n\nEnter password:\nSuccessfully unlocked vault\n</code></pre>"},{"location":"getting-started/#sync-time","title":"Sync time","text":"<p>Time must be synced to the vault on power reset as there is no battery-powered clock. Inaccurate time will result in invalid TOTP codes</p> <pre><code>$ totpvault-cli sync-time\n\nSuccessfully synced time to: 2026-01-10 05:44:50.866425 UTC\n</code></pre>"},{"location":"getting-started/#verify-time-sync-and-unlocked-status","title":"Verify time-sync and unlocked status","text":"<pre><code>$ totpvault-cli dev-info\n\nDevice Status:\n    Vault: Unlocked\n    Total Slots: 64\n    Used Slots: 0\n    Free Slots: 64\n    Current Timestamp: 1768023870 delta=2 (In-sync)\n    Version: TOTPVault Version 0.1\n    ED25519 Public Key: IiG0924qxqsDTs7TF8ZAexXJh2ZsRA5hcd9juC0tBGM=\n    Key Fingerprint (SHA256): D9:42:BB:FB:7C:D8:B8:47:3D:AF:72:34:98:2B:44:61:4E:BD:8A:AD:32:97:52:C0:14:9C:96:63:5C:22:39:42\n</code></pre> <p><code>Vault: Unlocked</code> and <code>Current Timestamp: 1768023870 (In-sync)</code> shows that the vault's time is in sync</p> <p>Note the key fingerprint <code>D9:42:BB:FB:7C:D8...</code>. This is the fingerprint of the public key of the device which can be used to authenticate it.</p>"},{"location":"getting-started/#add-a-credential","title":"Add a credential","text":"<p>Login to the account you wish to add and enable a new TOTP credential</p> <p>When the QR code displays, there should be a option such as \"can't scan code\" which displays a string such as <code>r7uk mfjw zboh 3x3u ccij bptu leeq thk6</code></p> <p>Next, run the following command pasting the string from above</p> <pre><code>$ totpvault-cli add-credential --domain-name google.com\n\nEnter TOTP Secret Key:\nSuccessfully added credential\n</code></pre> <p>It is wise to keep a backup 2FA device/method available in case you lose your TOTPVault token!</p>"},{"location":"getting-started/#list-credentials","title":"List credentials","text":"<pre><code>$ totpvault-cli list-credentials\n\n[Slot 0]: google.com\n</code></pre>"},{"location":"getting-started/#get-totp-code","title":"Get TOTP code","text":"<p>If the code is incorrect, wait until the next code rolls over (or 30+ sec) since there can be a small delay with the device generating the code</p> <pre><code>$ totpvault-cli totp-code -d google.com\n\n056086\n11s remaining\n</code></pre> <p>Refer to the Commands section for detailed usage of each command.</p>"},{"location":"hardware/","title":"Hardware Overview","text":"<p>The TOTPVault device is designed with a focus on security and simplicity. Below is a detailed overview of its components and design.</p> <p></p>"},{"location":"hardware/#specifications","title":"Specifications","text":"<ul> <li>Secure Processor: ESP32-C3<ul> <li>4MB Flash Storage</li> </ul> </li> <li>USB-to-UART Adapter: CH343P</li> <li>USB Connector: USB-A</li> <li>Protection: TVS Diode for static discharge protection on USB lines</li> <li>Debug Interface: 5-pin header<ul> <li>TX/RX (serial communication)</li> <li>3.3V Power</li> <li>Ground</li> <li>DFU mode pin</li> </ul> </li> <li>Physical Buttons:<ul> <li>Reset button</li> <li>DFU mode button</li> </ul> </li> </ul>"},{"location":"system-design/","title":"System Design","text":""},{"location":"system-design/#security-features","title":"Security Features","text":""},{"location":"system-design/#secret-storage","title":"Secret Storage","text":"<ul> <li>TOTP secrets are encrypted at rest using AES-256-GCM, ensuring data confidentiality</li> <li>Encryption keys derived from vault password using PBKDF2, device has no knowledge of decryption keys without vault password</li> <li>The keys are never stored on the device (ie. the device cannot decrypt any secrets without the user providing the vault password)</li> <li>Encrypted TOTP secrets are stored in NVS (flash) on the same die as the microcontroller, making it difficult to sniff/extract them</li> <li>Secrets are zeroed from memory immediately after use      </li> </ul>"},{"location":"system-design/#system-firmware","title":"System Firmware","text":"<ul> <li>ESP32-C3 firmware has secure boot enabled with RSA 3072 signature verification, ensuring only trusted firmware can run</li> <li>Firmware is encrypted using hardware-accelerated AES, providing an additional layer of security and mitigating TOCTOU attacks on secure boot</li> <li>Firmware is written in Rust with minimal <code>unsafe</code> regions</li> <li>Device can be attested with a challenge to prove itself</li> <li>ESP32-C3 hardware random number generator is used for cryptographic operations      </li> </ul>"},{"location":"system-design/#hardware-design","title":"Hardware Design","text":"<ul> <li>TOTP secrets are encrypted and stored in on-chip flash memory, substantially complicating attacks to dump or snoop secrets</li> <li> <p>USB interface is delegated to a separate chip (CH343P) from the main microcontroller (ESP32-C3) in order to isolate any USB-level exploits from the main uC      </p> </li> <li> <p>JTAG interfaces are disabled and eFuses locked down</p> </li> </ul>"},{"location":"system-design/#security-limitations","title":"Security Limitations","text":"<ul> <li>Communication between the <code>ESP32 &lt;-&gt; USB/UART Chip &lt;-&gt; Host</code> is unencrypted. After the vault has been unlocked, it is possible for an attacker to sniff these buses for plain-text TOTP codes and TOTP secrets (but only if the sniffing occurs while adding a new credential). It is impossible to extract a TOTP secret once it is stored.</li> </ul>"},{"location":"updating-firmware/","title":"Updating Firmware","text":"<p>To update the firmware on your TOTPVault device, you will need to put it into DFU (Device Firmware Update) mode.</p>"},{"location":"updating-firmware/#steps-to-update-firmware","title":"Steps to update firmware:","text":"<ol> <li>Prepare the device: Hold down the DFU button on the TOTPVault device.</li> <li>Connect to computer: While holding the DFU button, plug the device into your computer's USB port.</li> <li>Release DFU button: Once connected, you can release the DFU button. The device should now be in DFU mode, ready to receive new firmware.</li> </ol> <p>Once in DFU mode, you can use the appropriate flashing tool (e.g., <code>esptool.py</code> or <code>cargo espflash</code>) to upload the new firmware. Specific commands will depend on your development environment and the firmware image.</p>"}]}